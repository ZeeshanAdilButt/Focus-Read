(()=>{chrome.action.onClicked.addListener(e=>{chrome.sidePanel.open({tabId:e.id})});let e=null;chrome.runtime.onInstalled.addListener(()=>{chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}),chrome.contextMenus.create({id:"focus-read-from-here",title:"Flow from here",contexts:["selection","page","frame"],documentUrlPatterns:["<all_urls>"]})}),chrome.contextMenus.onClicked.addListener((e,n)=>{"focus-read-from-here"===e.menuItemId&&chrome.tabs.sendMessage(n.id,{action:"getClickedWordIndex"},t=>{const c=t?.wordIndex??-1;chrome.sidePanel.open({tabId:n.id},()=>{setTimeout(()=>{chrome.runtime.sendMessage({action:"contextMenuTriggered",selectionText:e.selectionText||"",clickedWordIndex:c,tabId:n.id})},600)})})}),chrome.runtime.onMessage.addListener((n,t,c)=>("openFullscreen"===n.action&&(e={words:n.words,currentIndex:n.currentIndex,config:n.config,wasPlaying:n.wasPlaying},chrome.windows.create({url:chrome.runtime.getURL("fullscreen.html"),type:"popup",state:"fullscreen"}),c({success:!0})),"getFullscreenContent"===n.action&&c(e||{words:[],currentIndex:0}),"fullscreenClosed"===n.action&&(chrome.runtime.sendMessage({action:"syncFromFullscreen",currentIndex:n.currentIndex,wasPlaying:n.wasPlaying}).catch(()=>{}),e=null,c({success:!0})),"fullscreenSync"===n.action&&chrome.runtime.sendMessage({action:"syncFromFullscreen",currentIndex:n.currentIndex,wasPlaying:!1}).catch(()=>{}),"highlightFromFullscreen"===n.action&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{e[0]&&chrome.tabs.sendMessage(e[0].id,{action:"highlightWord",index:n.index,wordCount:n.wordCount,text:n.text}).catch(()=>{})}),"clearHighlightFromFullscreen"===n.action&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{e[0]&&chrome.tabs.sendMessage(e[0].id,{action:"clearHighlight"}).catch(()=>{})}),!0))})();